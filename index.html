<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>360图床 - 手机上传</title>
    <style>
        /* CSS 样式开始 */
        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif; /* 引入更现代的字体 */
            margin: 0;
            padding: 20px 15px; /* 略微调整内边距 */
            background: linear-gradient(135deg, #e0f2f7 0%, #b3e5fc 100%); /* 更柔和的背景渐变 */
            color: #333;
            line-height: 1.7; /* 稍微增加行高，提高可读性 */
            -webkit-text-size-adjust: 100%; /* Prevent text size adjustment on mobile */
            display: flex; /* 使用flex布局使内容居中 */
            justify-content: center;
            align-items: center;
            min-height: 100vh; /* 确保内容能占满整个视口高度 */
        }

        .container {
            width: 100%; /* 让容器宽度适应小屏幕 */
            max-width: 550px; /* 限制最大宽度 */
            margin: 0 auto;
            background-color: rgba(255, 255, 255, 0.95); /* 半透明白色背景 */
            padding: 25px; /* 增加内边距 */
            border-radius: 12px; /* 更圆润的边角 */
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.15); /* 更深的阴影 */
            text-align: center;
            backdrop-filter: blur(5px); /* 添加背景模糊效果 */
            -webkit-backdrop-filter: blur(5px); /* Safari 兼容 */
        }

        h1, h2 {
            color: #0277bd; /* 更深的蓝色，用于标题 */
            margin-bottom: 25px; /* 增加标题下方间距 */
            font-weight: 600; /* 字体加粗 */
        }

        .upload-area {
            margin-bottom: 30px;
            padding: 30px 20px; /* 增加内边距 */
            border: 2px dashed #b3e5fc; /* 使用更亮的蓝色边框 */
            border-radius: 10px; /* 圆润边角 */
            background-color: #ffffff; /* 白色背景 */
            cursor: pointer;
            transition: background-color 0.3s ease, border-color 0.3s ease; /* 过渡效果 */
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 150px; /* 增加最小高度 */
        }

        .upload-area:hover {
            background-color: #e3f2fd; /* 悬停时背景变浅 */
            border-color: #0288d1; /* 悬停时边框变深 */
        }

        #uploadStatus {
            margin-top: 15px;
            font-weight: 500; /* 中等粗细 */
            color: #555; /* 稍浅的灰色 */
            min-height: 1.7em; /* 避免内容变化导致布局跳动 */
        }

        /* 加载状态指示器 */
        .uploading-indicator::after {
            content: '';
            display: inline-block;
            width: 16px;
            height: 16px;
            border: 2px solid #ccc;
            border-top-color: #0277bd; /* 主题色 */
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-left: 10px;
            vertical-align: middle;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }


        .btn-primary {
            display: inline-block;
            background-color: #0277bd; /* 深蓝色 */
            color: white;
            padding: 12px 30px; /* 增加按钮大小 */
            border: none;
            border-radius: 8px; /* 圆角按钮 */
            cursor: pointer;
            font-size: 1.1em;
            font-weight: 500; /* 中等粗细 */
            transition: background-color 0.3s ease, transform 0.2s ease; /* 添加点击缩放效果 */
            box-shadow: 0 4px 10px rgba(2, 119, 189, 0.3); /* 按钮阴影 */
            margin-bottom: 10px; /* 为uploadStatus留出空间 */
        }

        .btn-primary:hover {
            background-color: #0288d1; /* 悬停时变亮 */
            transform: translateY(-2px); /* 鼠标悬停时轻微上移 */
        }
        .btn-primary:active {
            transform: translateY(0); /* 点击时恢复原位 */
            box-shadow: 0 2px 5px rgba(2, 119, 189, 0.3); /* 点击时减小阴影 */
        }

        .btn-secondary {
            display: inline-block;
            background-color: #78909c; /* 中度灰色 */
            color: white;
            padding: 8px 18px;
            border: none;
            border-radius: 6px; /* 圆角 */
            cursor: pointer;
            font-size: 0.95em; /* 调整字体大小 */
            margin-left: 10px;
            transition: background-color 0.3s ease, transform 0.2s ease;
            box-shadow: 0 2px 5px rgba(120, 144, 156, 0.3); /* 按钮阴影 */
        }

        .btn-secondary:hover {
            background-color: #90a4ae; /* 悬停时变亮 */
            transform: translateY(-1px);
        }
         .btn-secondary:active {
            transform: translateY(0);
            box-shadow: 0 1px 3px rgba(120, 144, 156, 0.3);
        }

        .result-area {
            margin-top: 25px; /* 增加上边距 */
            padding: 20px;
            border: 1px solid #e0e0e0; /* 更浅的边框 */
            border-radius: 10px; /* 圆角 */
            background-color: #fdfdfd; /* 更干净的背景 */
            text-align: center;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.05); /* 轻微阴影 */
        }

        .uploaded-image {
            max-width: 100%;
            height: auto;
            margin-bottom: 20px; /* 增加底部间距 */
            border-radius: 8px; /* 圆角图片 */
            border: 1px solid #e0e0e0; /* 图片边框 */
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.08); /* 图片阴影 */
        }

        .image-link {
            display: flex;
            align-items: center;
            justify-content: center;
            flex-wrap: wrap;
            margin-top: 15px;
            background-color: #f9f9f9; /* 链接区域背景 */
            padding: 15px 10px;
            border-radius: 8px;
            border: 1px solid #eee;
        }

        .image-link span {
            margin-right: 12px;
            margin-bottom: 8px;
            font-size: 0.95em; /* 调整文字大小 */
            color: #555;
            flex-shrink: 0; /* 防止文字被压缩 */
        }

        .image-link input[type="text"] {
            flex-grow: 1;
            padding: 10px 12px; /* 增加输入框内边距 */
            border: 1px solid #ccc;
            border-radius: 6px;
            font-size: 0.95em;
            background-color: #fff;
            margin-bottom: 8px;
            box-sizing: border-box; /* 确保padding和border包含在width内 */
            width: 100%; /* 默认宽度100% */
        }

        .history-area {
            margin-top: 30px;
            padding: 20px;
            border: 1px solid #e0e0e0;
            border-radius: 10px;
            background-color: #fdfdfd;
            text-align: left;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.05);
        }

        /* Font import for Inter */
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&display=swap');


        /* Responsive adjustments */
        @media (max-width: 480px) {
            .container {
                padding: 20px; /* 减小内边距 */
            }
            .btn-primary {
                font-size: 1em;
                padding: 10px 25px; /* 调整按钮大小 */
            }
            .btn-secondary {
                margin-left: 0; /* 去掉边距 */
                margin-top: 10px; /* 增加顶部边距 */
            }
            .image-link {
                flex-direction: column;
                align-items: stretch;
            }
            .image-link span {
                margin-right: 0;
                margin-bottom: 10px;
                text-align: center;
            }
            .image-link input[type="text"] {
                width: calc(100% - 24px); /* 调整宽度，考虑内边距 */
                margin-bottom: 10px;
            }
            .upload-area {
                padding: 25px 15px;
                min-height: 120px;
            }
        }
        /* CSS 样式结束 */
    </style>
</head>
<body>
    <div class="container">
        <h1>360图床</h1>

        <div class="upload-area">
            <input type="file" id="imageUpload" accept="image/*" hidden>
            <!-- 隐藏原始文件输入，通过按钮触发 -->
            <button id="uploadButton" class="btn-primary">选择图片上传</button>
            <p id="uploadStatus">请选择一张图片进行上传</p>
        </div>

        <div id="resultArea" class="result-area" style="display: none;">
            <h2>上传结果</h2>
            <img id="uploadedImage" src="" alt="上传的图片" class="uploaded-image">
            <div class="image-link">
                <span>图片链接:</span>
                <input type="text" id="imageUrl" readonly placeholder="图片链接将显示在这里...">
                <button id="copyButton" class="btn-secondary">复制</button>
            </div>
        </div>

        <!-- 可选的：历史统计/列表区域 -->
        <div id="historyArea" class="history-area" style="display: none;">
            <h2>历史记录</h2>
            <!-- 这里会展示历史列表 -->
            <p>（历史记录功能待实现）</p>
        </div>
    </div>

    <script>
        // JavaScript 代码开始
        const uploadButton = document.getElementById('uploadButton');
        const imageUpload = document.getElementById('imageUpload');
        const uploadStatus = document.getElementById('uploadStatus');
        const resultArea = document.getElementById('resultArea');
        const uploadedImage = document.getElementById('uploadedImage');
        const imageUrlInput = document.getElementById('imageUrl');
        const copyButton = document.getElementById('copyButton');
        // const historyArea = document.getElementById('historyArea'); // 如果需要历史记录

        // API 地址
        const API_URL = 'https://api.xinyew.cn/api/360tc';

        // 点击上传按钮时触发文件选择器
        uploadButton.addEventListener('click', () => {
            imageUpload.click();
        });

        // 让上传区域本身也支持点击来触发文件选择
        const uploadArea = document.querySelector('.upload-area');
        uploadArea.addEventListener('click', () => {
            imageUpload.click();
        });

        // 文件选择器内容变化时触发上传
        imageUpload.addEventListener('change', async (event) => {
            const file = event.target.files[0];
            if (!file) {
                // 用户取消了选择
                uploadStatus.textContent = '请选择一张图片进行上传';
                return;
            }

            // 简单的文件类型检查 (可选，但推荐)
            if (!file.type.startsWith('image/')) {
                uploadStatus.textContent = '请选择一个图片文件！';
                imageUpload.value = ''; // 清空文件选择器
                return;
            }

            // 显示上传状态并添加加载指示器
            uploadStatus.textContent = '正在上传';
            uploadStatus.classList.add('uploading-indicator');

            resultArea.style.display = 'none'; // 隐藏上一次的结果

            const formData = new FormData();
            // 假设 API 的参数名是 'file'，这通常是标准做法
            formData.append('file', file);

            try {
                // 再次确认 API 的请求方法。如果 API 确实是 GET 并且支持文件上传，
                // 请务必与开发者沟通具体如何将文件作为参数传递，可能需要Base64编码。
                // 以下代码继续以 POST 为例，这是处理文件上传的标准方式。
                const response = await fetch(API_URL, {
                    method: 'POST', // 保持 POST 方法，根据之前讨论
                    body: formData
                });

                if (!response.ok) {
                    // 如果网络请求本身失败 (例如 404, 500 等非 2xx 状态码)
                    let errorDetail = `网络请求失败: ${response.status} ${response.statusText}`;
                    try {
                        // 尝试解析服务器返回的 JSON 错误信息
                        const errorData = await response.json();
                        if (errorData && errorData.error) {
                            errorDetail = errorData.error; // 使用API提供的错误信息
                        } else if (errorData) {
                            errorDetail = JSON.stringify(errorData); // 或者直接显示原始错误信息
                        }
                    } catch (e) {
                        // 如果响应不是 JSON 格式，则使用默认的错误信息
                    }
                    throw new Error(errorDetail);
                }

                const data = await response.json(); // 解析JSON响应

                // *** 基于您提供的 API 返回结构进行判断 ***
                if (data.errno === 0 && data.data && data.data.url) {
                    // 上传成功
                    uploadStatus.textContent = '上传成功!';
                    uploadStatus.classList.remove('uploading-indicator'); // 移除加载指示器
                    const imageUrl = data.data.url; // 图片链接在此
                    uploadedImage.src = imageUrl;
                    imageUrlInput.value = imageUrl;
                    resultArea.style.display = 'block';
                } else {
                    // 上传失败，或返回了错误格式
                    const errorMessage = data.error || "上传失败，未知错误";
                    uploadStatus.textContent = `上传失败: ${errorMessage}`;
                    uploadStatus.classList.remove('uploading-indicator'); // 移除加载指示器
                    console.error('Upload failed:', data); // 打印失败的API返回数据，便于调试
                }

            } catch (error) {
                // 捕获网络请求错误或解析 JSON 过程中的错误
                console.error('Fetch or JSON parsing error:', error);
                uploadStatus.textContent = `上传失败: ${error.message}`;
                uploadStatus.classList.remove('uploading-indicator'); // 移除加载指示器
            } finally {
                // 无论成功还是失败，清空文件选择器，以便下次可以上传同一个文件
                imageUpload.value = '';
            }
        });

        // 复制图片链接
        copyButton.addEventListener('click', () => {
            imageUrlInput.select();
            imageUrlInput.setSelectionRange(0, 99999); // For mobile devices

            try {
                // navigator.clipboard.writeText() 是更现代的方式，但需要HTTPS或本地主机环境。
                // document.execCommand('copy') 兼容性更好，尤其是在本地文件打开时。
                const successful = document.execCommand('copy');
                if (successful) {
                    alert('图片链接已复制到剪贴板！');
                } else {
                    alert('复制失败，请手动复制链接。');
                }
            } catch (err) {
                console.error('Fallback: Oops, unable to copy', err);
                alert('复制失败，请手动复制链接。');
            }
        });

        // 如果您需要历史记录功能，请提供相应的API接口信息。
        // 届时可以在这里添加一个异步函数来获取并渲染历史数据。
        /*
        async function loadHistory() {
            try {
                // const historyResponse = await fetch('YOUR_HISTORY_API_URL');
                // const historyData = await historyResponse.json();
                // ... 渲染历史列表到 historyArea ...
                // historyArea.style.display = 'block';
            } catch (error) {
                console.error('Load history error:', error);
            }
        }
        loadHistory(); // 页面加载时调用
        */

        /* JavaScript 代码结束 */
    </script>
</body>
</html>
